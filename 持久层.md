# 持久层知识梳理

梳理一下 SpringBoot 中持久层常用技术的概念和使用方法。

## 1. JDBC

JDBC（Java Data Base Connectivity）即Java数据库连接，官方解释它是Java编程语言和广泛的数据库之间独立于数据库的连接标准的Java API，根本上说JDBC是一种规范，它提供的接口，一套完整的，允许便捷式访问底层数据库。简单说它就是JAVA与数据库的连接的桥梁或者插件，用JAVA代码就能操作数据库的增删改查、存储过程、事务等。

![img](https://images2015.cnblogs.com/blog/1066658/201702/1066658-20170203195903651-1572602039.png)

常用接口：

- JAVA API：提供对JDBC的管理链接；
- JAVA Driver API：支持JDBC管理到驱动器连接。
- DriverManager：这个类管理数据库驱动程序的列表，查看加载的驱动是否符合JAVA Driver API的规范。
- Connection：与数据库中的所有的通信是通过唯一的连接对象。
- Statement：把创建的SQL对象，转而存储到数据库当中。
- ResultSet：它是一个迭代器，用于检索查询数据。

使用流程：

![img](https://images2015.cnblogs.com/blog/1066658/201702/1066658-20170203203022667-674491962.png)

## 2. JPA

JPA（Java Persistence API）是 JDK 5.0 注解或 XML 描述对象－关系表的映射关系，并将运行期的实体对象持久化到数据库中。

## 3. ORM框架

ORM（Object Relational Mapping）框架采用元数据来描述对象与关系映射的细节，元数据一般采用 XML 格式，并且存放在专门的对象一映射文件中。简单理解为一种框架的格式

### 3.1 MyBatis

最大的特点是可以自由定制 mapper 中的 SQL 语句。

Maven 配置：

```xml
<dependency>	           	 
  <groupId>org.mybatis.spring.boot</groupId>	
  <artifactId>mybatis-spring-boot-starter</artifactId>	
  <version>2.0.1</version>	
</dependency>
```

YAML 配置：

```yaml
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource # druid 连接池
    driver-class-name: com.mysql.jdbc.Driver # MySQL 数据库
    url: jdbc:mysql://localhost:3306/weixin?serverTimezone=GMT%2B8&useSSL=true
    username: root
    password: zhs03171812
        
mybatis:
  mapperLocations: classpath:mapper/*Mapper.xml # mapper xml 文件地址	
  type-aliases-package: com.example.entity # entity 文件地址	
```

entity 类：

```java
@Data
public class User {
    private Integer id;
    private String userName;
    private String passWord;
    private String realName;
}
```

mapper xml:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.UserMapper">
 
    <select id="select" resultType="com.example.entity.User">
        select * from user where id = #{id}
    </select>
 
</mapper>
```

mapper 接口：

```java
@Repository
public interface UserMapper {
    User select(int id);
}
```

### 3.4 Spring Data JPA 



### 3.3 Hibernate、JPA、Spring Data JPA 三者之间的区别与联系

Hibernate 是持久化实现技术，是一种 ORM 框架；

JPA 是持久化的标准，一个是具体实现，一个是接口协议；

Spring Data JPA 是在 Hibernate 的基础上更上层的封装实现。

## 4. 数据库连接池

### 4.1 Druid

阿里开源项目 Druid，自带监控界面。

```xml
<dependency>
  <groupId>com.alibaba</groupId>
  <artifactId>druid-spring-boot-starter</artifactId>
  <version>1.1.9</version>
</dependency>
```

## 5. 数据库

### 5.1 MySQL

```xml
<dependency>	
    <groupId>mysql</groupId>	
    <artifactId>mysql-connector-java</artifactId>	
</dependency>
```

